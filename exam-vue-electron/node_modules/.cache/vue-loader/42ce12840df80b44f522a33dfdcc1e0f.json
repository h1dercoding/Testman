{"remainingRequest":"C:\\Users\\17982\\Desktop\\Testman\\exam-vue-electron\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\17982\\Desktop\\Testman\\exam-vue-electron\\src\\views\\monitor\\Monitor.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\17982\\Desktop\\Testman\\exam-vue-electron\\src\\views\\monitor\\Monitor.vue","mtime":1649769042000},{"path":"C:\\Users\\17982\\Desktop\\Testman\\exam-vue-electron\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1683967470734},{"path":"C:\\Users\\17982\\Desktop\\Testman\\exam-vue-electron\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1683967466085},{"path":"C:\\Users\\17982\\Desktop\\Testman\\exam-vue-electron\\node_modules\\babel-loader\\lib\\index.js","mtime":1683967472581},{"path":"C:\\Users\\17982\\Desktop\\Testman\\exam-vue-electron\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1683967470734},{"path":"C:\\Users\\17982\\Desktop\\Testman\\exam-vue-electron\\node_modules\\vue-loader\\lib\\index.js","mtime":1683967474246}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n/* eslint-disable */\nimport axios from 'axios'\nimport {message} from 'ant-design-vue';\n\nexport default {\n  name: 'Monitor',\n  data() {\n    return {\n      checkInterval: null,\n      checkTimer: 1000,  // 检查摄像头是否开启的定时器 ms\n      authenticationInterval: null,\n      authenticationTimer: 30000,  // 身份验证的定时器 ms\n      isMonitoring: true,\n      canvasDataUrl: '',\n    }\n  },\n  methods: {\n    authSuccess() {\n      message.success('身份验证成功');\n    },\n    authFail() {\n      message.error('身份验证失败')\n    },\n    authFailExecute() {\n      message.warning('请开启摄像头以确保身份验证正常运行')\n    },\n    authNetFail() {\n      message.warning('网络原因导致身份验证失败')\n    }\n  },\n  computed: {\n    base64Url() {\n      return this.canvasDataUrl.split('data:image/png;base64,')[1]\n    },\n  },\n  watch: {\n    canvasDataUrl(newVal, oldVal) {\n\n      const val = newVal.split('data:image/png;base64,')[1]\n\n      axios({\n        method: 'POST',\n        url: 'http://localhost:5000/ai',\n        data: {\n          img: val\n        }\n      })\n        .then((res) => {\n          const { text } = res.data\n          if (text !== 'Success') {\n            this.authSuccess();\n          } else {\n            this.authFail();\n          }\n        })\n        .catch((err) => {\n          this.authNetFail();\n        })\n    },\n  },\n  mounted() {\n    let monitor = this.$refs['monitor']\n    let canvas = this.$refs['photo']\n\n    let pr = navigator.mediaDevices.getUserMedia({ audio: false, video: true })\n\n    pr.then((mediaStream) => {\n      monitor.srcObject = mediaStream\n      monitor.play()\n      this.isMonitoring = true\n    }).catch((err) => {\n      if (err.message == 'Requested device not found') {\n        this.isMonitoring = false\n      }\n    })\n\n    // 每隔 2s 获取用户计算机摄像头权限\n    this.checkInterval = setInterval(() => {\n      let pr = navigator.mediaDevices.getUserMedia({ video: true })\n      pr.then((mediaStream) => {\n        // 若获取权限成功\n        // 若一开始（进入考试页面）就没有获取权限 || 中途摄像头不能正常工作\n        if (!monitor.srcObject || !monitor.srcObject.active) {\n          this.isMonitoring = true\n          monitor.srcObject = mediaStream\n          monitor.play()\n        }\n      }).catch((err) => {\n        // 若获取权限失败\n        if (err.message === 'Requested device not found') {\n          this.isMonitoring = false\n        }\n      })\n    }, this.checkTimer)\n\n    this.authenticationInterval = setInterval(() => {\n      // 若未获得摄像头权限\n      if (!this.isMonitoring) return this.authFailExecute();\n\n      canvas.getContext('2d').drawImage(monitor, 0, 0, 250, 160)\n      this.canvasDataUrl = canvas.toDataURL('image/png')\n    }, this.authenticationTimer)\n  },\n}\n",null]}